[log]
level = "debug"

[shared]
gatewaysvc = "localhost:9142"
jwt_secret = "top_secret_jwt_secret"
skip_user_groups_in_token = true

db_name = "test"
db_engine = "sqlite"

###########
# GATEWAY #
###########

[grpc]
address = "0.0.0.0:9142"

[grpc.services.gateway]
commit_share_to_storage_grant = true
commit_share_to_storage_ref = true
disable_home_creation_on_login = true
transfer_shared_secret = "top_secret_transfer_shared_secret"
transfer_expires = 86400
home_mapping = ""
home_layout = "/localfs/"
etag_cache_ttl = 0
create_home_cache_ttl = 1
resource_info_cache_ttl = 60
resource_info_cache_type = "memory"
ocm_enabled = false

authregistrysvc = "localhost:9142"
storageregistrysvc = "localhost:9142"
appregistrysvc = "localhost:9142"
preferencessvc = "localhost:9142"
userprovidersvc = "localhost:9142"
groupprovidersvc = "localhost:9142"
usershareprovidersvc = "localhost:9142"
publicshareprovidersvc = "localhost:9142"
spacessvc = "localhost:9142"

datagateway = "http://localhost:38001/data"

allowed_user_agents = { "/home" = ["grpc", "desktop"] }

[grpc.services.gateway.token_managers.jwt]
expires_next_weekend = true
expires = 86400

[grpc.services.preferences]
driver = "sql"

[grpc.services.preferences.drivers.sql]

###########
# STORAGE #
###########

[grpc.services.spacesregistry]
driver = "sql"
user_space = "/localfs" # "/eos/user/{{substr 0 1 .Username}}/{{ .Username }}"
machine_secret = "top_secret_machine_secret"
resource_info_cache_ttl = 300
resource_info_cache_type = "memory"

[grpc.services.spacesregistry.drivers.sql]

[grpc.services.storageregistry]
driver = "static"

[grpc.services.storageregistry.drivers.static]
home_provider = "/home"

[grpc.services.storageregistry.drivers.static.rules]
"/localfs" = {"address" = "localhost:9142"}
"localfs" = {"address" = "localhost:9142"}

[grpc.services.storageprovider]
driver = "local"
mount_path = "/localfs"
mount_id = "localfs"
data_server_url = "http://localhost:38001/data"
minimum_allowed_path_level_for_share = 0
expose_data_server = true

[grpc.services.storageprovider.drivers.local]
disable_home = true
root = "./tmp/revalocalstorage/data"
share_folder = "./tmp/revalocalstorage/shares"

########
# AUTH #
########

[grpc.services.authregistry]
driver = "static"

[grpc.services.authregistry.drivers.static.rules]
basic = "localhost:9142"
bearer = "localhost:9142"
publicshares = "localhost:9142"

[grpc.services.authprovider]
auth_manager = "json"

[grpc.services.authprovider.auth_managers.json]
users = "./tmp/users.json"

[grpc.services.userprovider]
driver = "json"

[grpc.services.userprovider.drivers.json]
users = "./tmp/users.json"

[grpc.services.groupprovider]
driver = "json"

[grpc.services.groupprovider.drivers.json]
groups = "./tmp/groups.json"

########
# HTTP #
########

[http]
address = "0.0.0.0:38001"

[http.services.dataprovider]
driver = "local"

[http.services.dataprovider.drivers.local]
root = "./tmp/revalocalstorage/data"
